#/bin/sh

parse_arguments() {
    while [ $# -gt 0 ]
    do
        case $1 in
            -f | --file)
                MAKEFILE=$2
                shift 2
                ;;
            *)
                shift 1
                ;;
        esac
    done

    [ -z "$MAKEFILE" ] && MAKEFILE=Makefile
    MAKEFILE_BRK=$MAKEFILE.brk
}

parse_arguments $*

echo 'include $(BREAK_INCLUDE_DIR)/prologue.mk' >  $MAKEFILE_BRK
echo "include $MAKEFILE"                        >> $MAKEFILE_BRK
echo 'include $(BREAK_INCLUDE_DIR)/epilogue.mk' >> $MAKEFILE_BRK

if [ -f .make_path ]
then
    readonly MAKE=$(cat .make_path)
else
    readonly MAKE='/usr/bin/env make'
fi
eval $MAKE -f $MAKEFILE_BRK "$@"

rm $MAKEFILE_BRK
